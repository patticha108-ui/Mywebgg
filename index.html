<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DEK-DEK AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Itim&family=Kanit:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Itim', 'Kanit', sans-serif;
            background-color: #f8fafc;
            overscroll-behavior-y: contain;
        }

        .chat-area {
            height: calc(100vh - 160px);
        }

        .bubble {
            max-width: 80%;
            transition: all 0.2s ease-in-out;
            position: relative;
        }

        .ai-bubble {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 20px 20px 20px 4px;
            color: #1e293b;
        }

        .user-bubble {
            background: #3b82f6;
            color: white;
            border-radius: 20px 20px 4px 20px;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .emoji-profile {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            border: 2px solid #e2e8f0;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Header Section -->
    <header class="bg-white border-b border-gray-200 p-4 flex items-center justify-between shadow-sm z-10">
        <div class="flex items-center gap-3">
            <div class="relative">
                <div class="emoji-profile">üê∂</div>
                <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
            </div>
            <div>
                <h1 class="text-lg font-bold text-gray-800">‡πÄ‡∏î‡∏Ñ‡πÜ AI</h1>
                <p class="text-[10px] text-green-600 font-bold uppercase tracking-widest">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
        </div>
        <div class="text-gray-400">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
        </div>
    </header>

    <!-- Chat Interface -->
    <main id="chatBox" class="chat-area overflow-y-auto p-4 space-y-4 no-scrollbar flex-1 bg-[#f1f5f9]">
        <div class="flex justify-start">
            <div class="bubble ai-bubble p-4 shadow-sm text-lg">
                ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Æ‡∏∞‡∏û‡∏µ‡πà! ‡πÄ‡∏î‡∏Ñ‡πÜ ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡∏Æ‡∏∞? ‡πÄ‡∏î‡∏Ñ‡πÜ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞!
            </div>
        </div>
    </main>

    <!-- Message Input -->
    <footer class="p-4 bg-white border-t border-gray-200 shadow-lg">
        <div class="max-w-4xl mx-auto flex gap-3">
            <input 
                type="text" 
                id="userInput" 
                placeholder="‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤‡πÄ‡∏î‡∏Ñ‡πÜ..." 
                class="flex-1 bg-gray-50 border border-gray-200 rounded-2xl px-5 py-3 outline-none focus:border-blue-400 transition-all text-lg"
                onkeypress="if(event.key === 'Enter') handleSend()"
            >
            <button 
                onclick="handleSend()" 
                id="sendBtn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 rounded-2xl transition-all active:scale-95 flex items-center justify-center"
            >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
    </footer>

    <script>
        const apiKey = ""; 
        const systemPrompt = "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ '‡πÄ‡∏î‡∏Ñ‡πÜ' ‡∏´‡∏°‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤ ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡πá‡∏Å‡∏ã‡∏∑‡πà‡∏≠‡πÜ ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏° ‡πÅ‡∏ó‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ß‡πà‡∏≤ '‡πÄ‡∏î‡∏Ñ‡πÜ' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÄ‡∏î‡∏Ñ' ‡πÄ‡∏™‡∏°‡∏≠ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£‡πÅ‡∏ö‡∏ö‡πÑ‡∏£‡πâ‡πÄ‡∏î‡∏µ‡∏¢‡∏á‡∏™‡∏≤ ‡∏ä‡∏≠‡∏ö‡∏°‡∏≠‡∏á‡πÇ‡∏•‡∏Å‡πÉ‡∏ô‡πÅ‡∏á‡πà‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô";
        let history = [];

        async function handleSend() {
            const input = document.getElementById('userInput');
            const btn = document.getElementById('sendBtn');
            const text = input.value.trim();
            
            if (!text || btn.disabled) return;

            input.value = '';
            btn.disabled = true;
            appendMessage('user', text);

            const typingId = showTyping();

            try {
                // Check if user wants an image
                if (text.includes('‡∏ß‡∏≤‡∏î') || text.includes('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ')) {
                    await generateImage(text, typingId);
                } else {
                    await generateChat(text, typingId);
                }
            } catch (err) {
                removeTyping(typingId);
                appendMessage('ai', "‡∏á‡∏∑‡πâ‡∏≠‡∏≠‡∏≠ ‡πÄ‡∏î‡∏Ñ‡πÜ ‡∏°‡∏∂‡∏ô‡∏´‡∏±‡∏ß‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏û‡∏µ‡πà‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞‡∏Æ‡∏∞");
            } finally {
                btn.disabled = false;
                scrollToBottom();
            }
        }

        async function generateChat(text, typingId) {
            history.push({ role: "user", parts: [{ text: text }] });

            const response = await fetchWithRetry(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: history,
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                }
            );

            const data = await response.json();
            const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "‡πÄ‡∏î‡∏Ñ‡πÜ ‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏û‡∏π‡∏î‡πÄ‡∏•‡∏¢‡∏Æ‡∏∞";
            
            removeTyping(typingId);
            appendMessage('ai', reply);
            history.push({ role: "model", parts: [{ text: reply }] });
        }

        async function generateImage(text, typingId) {
            const response = await fetchWithRetry(
                `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`,
                {
                    method: 'POST',
                    body: JSON.stringify({
                        instances: { prompt: "Cute puppy cartoon style, high quality, " + text },
                        parameters: { sampleCount: 1 }
                    })
                }
            );

            const data = await response.json();
            removeTyping(typingId);

            if (data.predictions?.[0]?.bytesBase64Encoded) {
                const imgUrl = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                appendImage(imgUrl);
                appendMessage('ai', "‡πÄ‡∏î‡∏Ñ‡πÜ ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Æ‡∏∞! ‡∏™‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?");
            } else {
                appendMessage('ai', "‡πÄ‡∏î‡∏Ñ‡πÜ ‡∏ß‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Æ‡∏∞ ‡∏™‡∏µ‡πÑ‡∏°‡πâ‡∏´‡∏°‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏•‡∏¢");
            }
        }

        async function fetchWithRetry(url, opts, retries = 5, delay = 1000) {
            try {
                const res = await fetch(url, opts);
                if (!res.ok) throw new Error();
                return res;
            } catch (err) {
                if (retries <= 0) throw err;
                await new Promise(r => setTimeout(r, delay));
                return fetchWithRetry(url, opts, retries - 1, delay * 2);
            }
        }

        function appendMessage(role, text) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `flex ${role === 'ai' ? 'justify-start' : 'justify-end'}`;
            div.innerHTML = `<div class="bubble ${role === 'ai' ? 'ai-bubble' : 'user-bubble'} p-4 shadow-sm text-lg">${text.replace(/\n/g, '<br>')}</div>`;
            box.appendChild(div);
            scrollToBottom();
        }

        function appendImage(url) {
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = "flex justify-start";
            div.innerHTML = `<div class="bubble ai-bubble p-2 shadow-sm"><img src="${url}" class="rounded-xl max-w-full"></div>`;
            box.appendChild(div);
            scrollToBottom();
        }

        function showTyping() {
            const id = 't-' + Date.now();
            const box = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex justify-start";
            div.innerHTML = `<div class="bubble ai-bubble p-4 flex gap-2 items-center"><div class="flex gap-1"><div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.2s"></div><div class="w-2 h-2 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.4s"></div></div></div>`;
            box.appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeTyping(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        function scrollToBottom() {
            const box = document.getElementById('chatBox');
            box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>

